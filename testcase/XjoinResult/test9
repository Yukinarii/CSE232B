for $tuple in join (

join (

join (

for $a1 in document("j_caesar.xml")//ACT,
$sp1 in $sc1//SPEAKER,
$sc1 in $a1//SCENE
return <tuple>{ <sp1>{$sp1}</sp1>, <a1>{$a1}</a1>, <sc1>{$sc1}</sc1> }</tuple>,

for $a2 in document("j_caesar.xml")//ACT,
$sp2 in $sc2//SPEAKER,
$sc2 in $a2//SCENE
return <tuple>{ <sp2>{$sp2}</sp2>, <a2>{$a2}</a2>, <sc2>{$sc2}</sc2> }</tuple>,

[sp1,sc1], [sp2,sc2]),

for $a3 in document("j_caesar.xml")//ACT,
$sp3 in $sc3//SPEAKER,
$sc3 in $a3//SCENE
return <tuple>{ <sp3>{$sp3}</sp3>, <a3>{$a3}</a3>, <sc3>{$sc3}</sc3> }</tuple>,

[sp2,sc2], [sp3,sc3]),

for $a4 in document("j_caesar.xml")//ACT,
$sp4 in $sc4//SPEAKER,
$sc4 in $a4//SCENE
return <tuple>{ <sp4>{$sp4}</sp4>, <sc4>{$sc4}</sc4>, <a4>{$a4}</a4> }</tuple>,

[sp3,sc3], [sp4,sc4])
return<result>{<speaker>{$tuple/sp1/*/text()}</speaker>,<scene>{$tuple/sc1/*/TITLE/text()}</scene>,<act1>{$tuple/a1/*/TITLE/text()}</act1>,<act2>{$tuple/a2/*/TITLE/text()}</act2>,<act3>{$tuple/a3/*/TITLE/text()}</act3>,<act4>{$tuple/a4/*/TITLE/text()}</act4>}</result>